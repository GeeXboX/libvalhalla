<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>libvalhalla: grabber_common.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">libvalhalla
   &#160;<span id="projectnumber">2.1.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">grabber_common.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="grabber__common_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * GeeXboX Valhalla: tiny media scanner API.</span>
<a name="l00003"></a>00003 <span class="comment"> * Copyright (C) 2009 Mathieu Schroeter &lt;mathieu@schroetersa.ch&gt;</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * This file is part of libvalhalla.</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * libvalhalla is free software; you can redistribute it and/or</span>
<a name="l00008"></a>00008 <span class="comment"> * modify it under the terms of the GNU Lesser General Public</span>
<a name="l00009"></a>00009 <span class="comment"> * License as published by the Free Software Foundation; either</span>
<a name="l00010"></a>00010 <span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> * libvalhalla is distributed in the hope that it will be useful,</span>
<a name="l00013"></a>00013 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00014"></a>00014 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00015"></a>00015 <span class="comment"> * Lesser General Public License for more details.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> * You should have received a copy of the GNU Lesser General Public</span>
<a name="l00018"></a>00018 <span class="comment"> * License along with libvalhalla; if not, write to the Free Software</span>
<a name="l00019"></a>00019 <span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA</span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#ifndef VALHALLA_GRABBER_COMMON_H</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#define VALHALLA_GRABBER_COMMON_H</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &lt;pthread.h&gt;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;stats.h&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;utils.h&quot;</span>
<a name="l00067"></a>00067 
<a name="l00071"></a><a class="code" href="grabber__common_8h.html#a1651b6736241f9f8c59fdcdadadce2ff">00071</a> <span class="preprocessor">#define GRABBER_CAP_AUDIO  (1 &lt;&lt; 0) </span>
<a name="l00072"></a><a class="code" href="grabber__common_8h.html#a993d79b924414cb213407d1de774384d">00072</a> <span class="preprocessor">#define GRABBER_CAP_VIDEO  (1 &lt;&lt; 1) </span>
<a name="l00073"></a><a class="code" href="grabber__common_8h.html#a0182ee09567026c8bc4e06d50cc63210">00073</a> <span class="preprocessor">#define GRABBER_CAP_IMAGE  (1 &lt;&lt; 2) </span>
<a name="l00081"></a><a class="code" href="structgrabber__param__t.html">00081</a> <span class="preprocessor">typedef struct grabber_param_s {</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span>
<a name="l00083"></a><a class="code" href="structgrabber__param__t.html#a55ea937dfda36bf0845db2e43bcdf8b7">00083</a>   metadata_plist_t *<a class="code" href="structgrabber__param__t.html#a55ea937dfda36bf0845db2e43bcdf8b7" title="List of priorities for metadata.">pl</a>;
<a name="l00085"></a><a class="code" href="structgrabber__param__t.html#a014a6bb20e30821449e207a2b6ba8818">00085</a>   <span class="keyword">struct </span>url_ctl_s *<a class="code" href="structgrabber__param__t.html#a014a6bb20e30821449e207a2b6ba8818" title="This pointer is intended to be used with all vh_url_new().">url_ctl</a>;
<a name="l00086"></a>00086 } <a class="code" href="structgrabber__param__t.html" title="Structure for the init of a grabber.">grabber_param_t</a>;
<a name="l00087"></a>00087 
<a name="l00091"></a><a class="code" href="structgrabber__list__t.html">00091</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>grabber_list_s {
<a name="l00092"></a>00092   <span class="keyword">struct </span>grabber_list_s *next;
<a name="l00093"></a>00093 
<a name="l00095"></a><a class="code" href="structgrabber__list__t.html#ab36b6d42dc52034561bc8c8657b01331">00095</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structgrabber__list__t.html#ab36b6d42dc52034561bc8c8657b01331" title="Textual identification of the grabber.">name</a>;
<a name="l00097"></a><a class="code" href="structgrabber__list__t.html#ab06f2fbb2ce205d1df07835eb15978d6">00097</a>   <span class="keywordtype">int</span> <a class="code" href="structgrabber__list__t.html#ab06f2fbb2ce205d1df07835eb15978d6" title="Flags to define the capabilities of the grabber.">caps_flag</a>;
<a name="l00098"></a>00098 
<a name="l00109"></a><a class="code" href="structgrabber__list__t.html#a06a42f2cbdd00540d9d0af08c37f5390">00109</a>   int (*init) (<span class="keywordtype">void</span> *priv, <span class="keyword">const</span> <a class="code" href="structgrabber__param__t.html" title="Structure for the init of a grabber.">grabber_param_t</a> *param);
<a name="l00110"></a>00110 
<a name="l00120"></a><a class="code" href="structgrabber__list__t.html#a1ab52d1be7d6cc348de108f344c5590d">00120</a>   void (*uninit) (<span class="keywordtype">void</span> *priv);
<a name="l00121"></a>00121 
<a name="l00147"></a><a class="code" href="structgrabber__list__t.html#aeafbc4aa2b09a03ac94b870542f231e9">00147</a>   int (*grab) (<span class="keywordtype">void</span> *priv, file_data_t *data);
<a name="l00148"></a>00148 
<a name="l00158"></a><a class="code" href="structgrabber__list__t.html#a4ec024d223322457485bcacea0b23e94">00158</a>   void (*loop) (<span class="keywordtype">void</span> *priv);
<a name="l00159"></a>00159 
<a name="l00165"></a><a class="code" href="structgrabber__list__t.html#a3efae683c0709b729e8d34a624ce6b76">00165</a>   <span class="keywordtype">void</span> *<a class="code" href="structgrabber__list__t.html#a3efae683c0709b729e8d34a624ce6b76" title="Private data for the grabber.">priv</a>;
<a name="l00166"></a>00166 
<a name="l00168"></a><a class="code" href="structgrabber__list__t.html#acdb47c7e4bdc0e823cae0e11e3a4ca7f">00168</a>   <a class="code" href="structgrabber__param__t.html" title="Structure for the init of a grabber.">grabber_param_t</a> <a class="code" href="structgrabber__list__t.html#acdb47c7e4bdc0e823cae0e11e3a4ca7f" title="Parameters for the grabber.">param</a>;
<a name="l00169"></a>00169 
<a name="l00171"></a>00171   <span class="keywordtype">int</span> enable;
<a name="l00172"></a>00172 
<a name="l00174"></a>00174   uint64_t timewait;
<a name="l00176"></a>00176   uint64_t timegrab;
<a name="l00177"></a>00177 
<a name="l00179"></a>00179   pthread_mutex_t mutex;
<a name="l00180"></a>00180 
<a name="l00182"></a>00182   vh_stats_tmr_t *tmr;
<a name="l00184"></a>00184   vh_stats_cnt_t *cnt_success;
<a name="l00186"></a>00186   vh_stats_cnt_t *cnt_failure;
<a name="l00188"></a>00188   vh_stats_cnt_t *cnt_skip;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 } <a class="code" href="structgrabber__list__t.html" title="Structure for a grabber.">grabber_list_t</a>;
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 
<a name="l00209"></a><a class="code" href="grabber__common_8h.html#aa7763239b18a352de8259ceb56c2a9d6">00209</a> <span class="preprocessor">#define GRABBER_REGISTER(p_name, p_caps, p_pl, p_tw,                          \</span>
<a name="l00210"></a>00210 <span class="preprocessor">                         fct_priv, fct_init, fct_uninit, fct_grab, fct_loop)  \</span>
<a name="l00211"></a>00211 <span class="preprocessor">  grabber_list_t *                                                            \</span>
<a name="l00212"></a>00212 <span class="preprocessor">  vh_grabber_##p_name##_register (struct url_ctl_s *url_ctl)                  \</span>
<a name="l00213"></a>00213 <span class="preprocessor">  {                                                                           \</span>
<a name="l00214"></a>00214 <span class="preprocessor">    grabber_list_t *grabber;                                                  \</span>
<a name="l00215"></a>00215 <span class="preprocessor">                                                                              \</span>
<a name="l00216"></a>00216 <span class="preprocessor">    vh_log (VALHALLA_MSG_VERBOSE, __FUNCTION__);                              \</span>
<a name="l00217"></a>00217 <span class="preprocessor">                                                                              \</span>
<a name="l00218"></a>00218 <span class="preprocessor">    grabber = calloc (1, sizeof (grabber_list_t));                            \</span>
<a name="l00219"></a>00219 <span class="preprocessor">    if (!grabber)                                                             \</span>
<a name="l00220"></a>00220 <span class="preprocessor">      return NULL;                                                            \</span>
<a name="l00221"></a>00221 <span class="preprocessor">                                                                              \</span>
<a name="l00222"></a>00222 <span class="preprocessor">    grabber-&gt;name      = #p_name;                                             \</span>
<a name="l00223"></a>00223 <span class="preprocessor">    grabber-&gt;caps_flag = p_caps;                                              \</span>
<a name="l00224"></a>00224 <span class="preprocessor">    grabber-&gt;enable    = 1;                                                   \</span>
<a name="l00225"></a>00225 <span class="preprocessor">    grabber-&gt;timewait  = p_tw * 1000000UL;                                    \</span>
<a name="l00226"></a>00226 <span class="preprocessor">    grabber-&gt;priv      = fct_priv ();                                         \</span>
<a name="l00227"></a>00227 <span class="preprocessor">                                                                              \</span>
<a name="l00228"></a>00228 <span class="preprocessor">    grabber-&gt;init      = fct_init;                                            \</span>
<a name="l00229"></a>00229 <span class="preprocessor">    grabber-&gt;uninit    = fct_uninit;                                          \</span>
<a name="l00230"></a>00230 <span class="preprocessor">    grabber-&gt;grab      = fct_grab;                                            \</span>
<a name="l00231"></a>00231 <span class="preprocessor">    grabber-&gt;loop      = fct_loop;                                            \</span>
<a name="l00232"></a>00232 <span class="preprocessor">                                                                              \</span>
<a name="l00233"></a>00233 <span class="preprocessor">    grabber-&gt;param.url_ctl = url_ctl;                                         \</span>
<a name="l00234"></a>00234 <span class="preprocessor">    grabber-&gt;param.pl = malloc (sizeof (p_pl));                               \</span>
<a name="l00235"></a>00235 <span class="preprocessor">    if (!grabber-&gt;param.pl)                                                   \</span>
<a name="l00236"></a>00236 <span class="preprocessor">    {                                                                         \</span>
<a name="l00237"></a>00237 <span class="preprocessor">      free (grabber);                                                         \</span>
<a name="l00238"></a>00238 <span class="preprocessor">      return NULL;                                                            \</span>
<a name="l00239"></a>00239 <span class="preprocessor">    }                                                                         \</span>
<a name="l00240"></a>00240 <span class="preprocessor">    memcpy (grabber-&gt;param.pl, p_pl, sizeof (p_pl));                          \</span>
<a name="l00241"></a>00241 <span class="preprocessor">                                                                              \</span>
<a name="l00242"></a>00242 <span class="preprocessor">    pthread_mutex_init (&amp;grabber-&gt;mutex, NULL);                               \</span>
<a name="l00243"></a>00243 <span class="preprocessor">                                                                              \</span>
<a name="l00244"></a>00244 <span class="preprocessor">    return grabber;                                                           \</span>
<a name="l00245"></a>00245 <span class="preprocessor">  }</span>
<a name="l00246"></a>00246 <span class="preprocessor"></span>
<a name="l00247"></a>00247 <span class="preprocessor">#endif </span><span class="comment">/* VALHALLA_GRABBER_COMMON_H */</span>
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 12 2012 12:56:58 for libvalhalla by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
